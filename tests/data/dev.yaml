checks:
  - cmd: docker --version
    rsp: ""
  - cmd: podman buildx version
    rsp: buildah 1.29.0

checks_buildx:
  - cmd: docker --version
    rsp: Docker version 20.10.7, build f0df350
  - cmd: docker buildx version
    rsp: buildx 0.29.0

get_git_name:
  - cmd: git rev-parse --show-toplevel
    rsp: /tmp/bl45p
  - cmd: git remote -v
    rsp: |
      github  git@github.com:epics-containers/bl45p.git (fetch)
      github  git@github.com:epics-containers/bl45p.git (push)

get_git_name_https:
  - cmd: git rev-parse --show-toplevel
    rsp: /tmp/ioc-adsimdetector
  - cmd: git remote -v
    rsp: |
      origin  https://github.com/epics-containers/ioc-adsimdetector (fetch)
      origin  https://github.com/epics-containers/ioc-adsimdetector (push)

launch_local_generic:
  - cmd: podman stop -t0 test-ioc
    rsp: "test-ioc stopped"
  - cmd: podman rm test-ioc
    rsp: "test-ioc"
  - cmd: podman run --rm --entrypoint 'bash' --name test-ioc -e DISPLAY -e SHELL --security-opt=label=type:container_runtime_t -v /tmp/ec_tests/ioc-template:/epics/ioc/config/ ghcr.io/epics-containers/ioc-adsimdetector-linux.developer:local -c '/epics/ioc/start.sh; bash'
    rsp: True

launch:
  - cmd: podman stop -t0 test-ioc
    rsp: "test-ioc stopped"
  - cmd: podman rm test-ioc
    rsp: "test-ioc"
  - cmd: podman run --rm --entrypoint 'bash' --name test-ioc -e DISPLAY -e SHELL --security-opt=label=type:container_runtime_t -v .*/iocs/bl45p-ea-ioc-01/config:/epics/ioc/config/ ghcr.io/epics-containers/ioc-adaravis-linux-developer:23.9.4 -c '/epics/ioc/start.sh; bash'
    rsp: True

debug_last1:
  - cmd: podman images | awk '{print $3}' | awk 'NR==2'
    rsp: ea2378de0b5f

debug_last2:
  - cmd: podman run --entrypoint bash --rm --name debug_build -e DISPLAY -e SHELL --security-opt=label=type:container_runtime_t -v/tmp/bl45p:/epics/ioc/$bl45p ea2378de0b5f
    rsp: True

versions:
  - cmd: podman run --rm quay.io/skopeo/stable list-tags docker://ghcr.io/epics-containers/bl45p-linux-developer
    rsp: True

stop:
  - cmd: podman stop -t0 test-ioc
    rsp: "test-ioc stopped"
  - cmd: podman rm test-ioc
    rsp: "test-ioc"

exec:
  - cmd: podman exec -e DISPLAY -e SHELL  test-ioc bash -c "bash"
    rsp: True
